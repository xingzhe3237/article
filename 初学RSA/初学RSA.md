# 初学RSA

[2018-12-03]()

现代密码学里面有对称加密和非对称加密。

**对称加密：**指的就是加、解密使用的同是一串密钥，所以被称做对称加密。对称加密只有一个密钥作为私钥。

> 常见的对称加密算法：DES，AES等。

**非对称加密：**指的是加、解密使用不同的密钥，一把作为公开的公钥，另一把作为私钥。公钥加密的信息，只有私钥才能解密。反之，私钥加密的信息，只有公钥才能解密。

> 非对称加密算法：RSA

* * *

接下来详细学习一下RSA算法。

## [](#第一步：生成密钥对，即公钥和私钥。 "第一步：生成密钥对，即公钥和私钥。")第一步：生成密钥对，即公钥和私钥。

### [](#1：随机找两个质数-P-和-Q-P-与-Q-越大，越安全。 "1：随机找两个质数 P 和 Q ,P 与 Q 越大，越安全。")1：随机找两个质数 P 和 Q ,P 与 Q 越大，越安全。

比如 P = 67 ，Q = 71。计算他们的乘积 n = P \* Q = 4757 ，转化为二进为 1001010010101，该加密算法即为 13 位，实际算法是 1024 位 或 2048 位，位数越长，算法越难被破解。

### [](#2：计算-n-的欧拉函数-φ-n-。 "2：计算 n 的欧拉函数 φ(n)。")2：计算 n 的欧拉函数 φ\(n\)。

φ\(n\) 表示在小于等于 n 的正整数之中，与 n 构成互质关系的数的个数。例如：在 1 到 8 之中，与 8 形成互质关系的是1、3、5、7，所以 φ\(n\) = 4。 如果 n = P _Q，P 与 Q 均为质数，则 φ\(n\) = φ\(P_ Q\)= φ\(P \- 1\)φ\(Q \- 1\) = \(P \- 1\)\(Q \- 1\) 。 本例中 φ\(n\) = 66 \* 70 = 4620，这里记为 m， m = φ\(n\) = 4620

### [](#3：随机选择一个整数-e，条件是1-lt-e-lt-m，且-e-与-m-互质。 "3：随机选择一个整数 e，条件是1< e < m，且 e 与 m 互质。")3：随机选择一个整数 e，条件是1\< e \< m，且 e 与 m 互质。

公约数只有 1 的两个整数，叫做互质整数，这里我们随机选择 e = 101 请注意不要选择 4619，如果选这个，则公钥和私钥将变得相同。

### [](#4：有一个整数-d，可以使得-e-d-除以-m-的余数为-1。 "4：有一个整数 d，可以使得 e*d 除以 m 的余数为 1。")4：有一个整数 d，可以使得 e\*d 除以 m 的余数为 1。

即找一个整数 d，使得 \(e _d \) \% m = 1。 等价于 e_ d \- 1 = y _m \( y 为整数） 找到 d ，实质就是对下面二元一次方程求解。 e_ x \- m \* y =1 ，其中 e = 101，m = 4620 101x \- 4620y =1 这个方程可以用”扩展欧几里得算法”求解，此处省略具体过程。 总之算出一组整数解（x，y ）= （ 1601，35），即 d = 1601。 到此密钥对生成完毕。不同的 e 生成不同的 d，因此可以生成多个密钥对。

本例中公钥为 （n，e\) = \(4757 , 101\)，私钥为 （n，d\) = \(4757 ，1601\) ，仅（n，e\) = \(4757 , 101\) 是公开的，其余数字均不公开。可以想像如果只有 n 和 e，如何推导出 d，目前只能靠暴力破解，位数越长，暴力破解的时间越长。

## [](#第二步：加密生成密文-。 "第二步：加密生成密文 。")第二步：加密生成密文 。

比如甲向乙发送汉字“中”，就要使用乙的公钥加密汉字 “中”， 以 utf-8 方式编码为 \[e4 b8 ad\]，转为 10 进制为 \[228,184,173\]。要想使用公钥（n，e\) = \(4757 , 101\)加密，要求**被加密的数字必须小于 n，被加密的数字必须是整数**，字符串可以取 ascii 值或unicode值，因此将“中”字折为三个字节 \[228,184,173\]，分别对三个字节加密。 假设 a 为明文，b 为密文，则按下列公式计算出 b

```
a^e % n = b
计算 [228,184,173]的密文：

228^101 % 4757 = 4296

184^101 % 4757 = 2458

173^101 % 4757 = 3263
```

即 \[228,184,173\]加密后得到密文 \[4296，2458，3263\] ，如果没有私钥 d ,神仙也无法从 \[4296，2458，3263\]中恢复 \[228,184,173\]。

解密生成明文。  
乙收到密文 \[4296，2458，3263\]，并用自己的私钥（n，d\) = \(4757 ，1601\) 解密。解密公式如下： 假设 a 为明文，b 为密文，则按下列公式计算出 a

```
a^d % n = b
密文 [4296，2458，3263]的明文如下：

4296^1601% 4757 = 228

2458^1601% 4757 = 184

3263^1601% 4757 = 173
```

即密文 \[4296，2458，3263\] 解密后得到 \[228,184,173\] 将\[228,184,173\] 再按 utf-8 解码为汉字 “中”，至此解密完毕。

## [](#写在最后 "写在最后")写在最后

最后，问题来了，有没有可能在已知 （n，e\) 的情况下，推导出 d。  
  
根据以上密钥对的生成过程：

* 如果想知道 d 需要知道欧拉函数 φ\(n\)
* 如果想知道欧拉函数 φ\(n\) 需要知道 P 和 Q
* 要知道 P 和 Q 需要对 n 进行因数分解。

对于本例中的 4757 你可以轻松进行因数分解，但对于大整数的因数分解，是一件很困难的事情，目前除了暴力破解，还没有更好的办法，如果以目前的计算速度，破解需要50年以上，则这个算法就是安全的。